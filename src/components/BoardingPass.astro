---
import { Icon } from 'astro-icon/components'
import PerforationStrip from './PerforationStrip.astro'

export type Props = {
  projectName: string
  completedYear: string
  technologies: string[]
  description: string
  liveUrl?: string
  githubUrl?: string
  imageUrl?: string
  imageSrcSet?: string
  class?: string
  isFirst?: boolean
}

const {
  projectName,
  completedYear,
  technologies,
  description,
  liveUrl,
  githubUrl,
  imageUrl,
  imageSrcSet,
  class: className = '',
  isFirst = false,
} = Astro.props

type ActionLink = {
  href: string
  label: string
  className: string
}

const createLink = (
  href: string | undefined,
  label: string,
  className: string
): ActionLink | null => (href ? { href, label, className } : null)

const actionLinks = [
  createLink(
    liveUrl,
    'Live',
    'rounded bg-emerald-700 px-2 py-1 text-xs text-white transition-colors hover:bg-emerald-800 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-800'
  ),
  createLink(
    githubUrl,
    'GitHub',
    'rounded bg-terminal-dark-gray px-2 py-1 text-xs text-white transition-colors hover:bg-gray-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-gray-700'
  ),
].filter((link): link is ActionLink => link !== null)
---

<div class={`boarding-pass ${className} group`}>
  <PerforationStrip />

  <div class="bg-white p-2 md:p-6">
    <div
      class="grid grid-cols-1 gap-6 md:[grid-template-columns:minmax(0,2fr)_minmax(0,1fr)]"
    >
      <div
        class="flex flex-col items-center gap-6 text-center lg:flex-row lg:items-center lg:text-left"
      >
        <div class="w-full space-y-4 md:flex-1">
          <div>
            <div class="text-xs uppercase tracking-wide text-gray-500">
              Project
            </div>
            <div class="text-lg font-bold text-terminal-dark-gray">
              {projectName}
            </div>
          </div>
          <div>
            <div class="text-xs uppercase tracking-wide text-gray-500">
              Completed
            </div>
            <div class="text-sm text-gray-700">{completedYear}</div>
          </div>
        </div>

        <Icon
          name="mdi:airplane"
          class="h-20 w-20 flex-shrink-0 text-terminal-light-gray md:h-44 md:w-44"
          aria-hidden="true"
        />

        {
          imageUrl && liveUrl && (
            <div class="w-full md:flex-1">
              <a href={liveUrl} target="_blank" rel="noopener noreferrer">
                <img
                  src={imageUrl}
                  srcset={imageSrcSet}
                  sizes="(max-width: 768px) 100vw, (max-width: 1152px) 624px, 800px"
                  alt={projectName}
                  class="h-32 w-full rounded-lg object-cover shadow-md"
                  loading={isFirst ? 'eager' : 'lazy'}
                  fetchpriority={isFirst ? 'high' : 'low'}
                />
              </a>
            </div>
          )
        }
      </div>

      <div class="space-y-4">
        <div>
          <div class="text-xs uppercase tracking-wide text-gray-500">
            Tech Stack
          </div>
          <div class="mt-1 flex flex-wrap gap-1">
            {
              technologies.map((tech) => (
                <span class="rounded bg-terminal-light-gray px-2 py-1 text-xs text-terminal-dark-gray">
                  {tech}
                </span>
              ))
            }
          </div>
        </div>
        <div>
          <div class="text-xs uppercase tracking-wide text-gray-500">Links</div>
          <div class="mt-1 flex gap-2">
            {
              actionLinks.map(({ href, label, className: linkClass }) => (
                <a
                  href={href}
                  target="_blank"
                  rel="noopener noreferrer"
                  class={linkClass}
                >
                  {label}
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </div>

    <div class="mt-6 border-t border-gray-200 pt-4">
      <div class="mb-2 text-xs uppercase tracking-wide text-gray-500">
        Description
      </div>
      <p class="text-sm leading-relaxed text-gray-700">{description}</p>
    </div>

    <PerforationStrip />
  </div>
</div>
